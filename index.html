<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horizontal Organizational Chart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .org-box {
            position: relative;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 180px;
            max-width: 220px;
            text-align: center;
        }
        
        .org-box:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }
        
        .org-box.board {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            color: white;
            border-color: #1e40af;
            font-weight: bold;
        }
        
        .org-box.executive {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border-color: #7c3aed;
        }
        
        .org-box.pldt-ops {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border-color: #b91c1c;
        }
        
        .org-box.smart-ops {
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
            border-color: #15803d;
        }
        
        .org-box.shared-services {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border-color: #4b5563;
        }
        
        .org-box.sub-function {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
        }
        
        .org-box.avp {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border-color: #d97706;
        }
        
        .org-box.senior-manager {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
            border-color: #475569;
        }
        
        .org-box.officer {
            background: linear-gradient(135deg, #a16207, #92400e);
            color: white;
            border-color: #92400e;
        }
        
        .org-box.staff {
            background: white;
            color: #374151;
            border: 2px solid #d1d5db;
        }
        
        .horizontal-container {
            display: flex;
            align-items: flex-start;
            gap: 40px;
            padding: 20px;
            overflow-x: auto;
            min-height: 100vh;
        }
        
        .vertical-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }
        
        .org-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 240px;
            position: relative;
        }
        
        .org-level-horizontal {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: center;
            margin: 0 20px;
        }
        
        .org-level-vertical {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-wrap: wrap;
            margin: 20px 0;
            position: relative;
            gap: 20px;
        }
        
        .connecting-line-horizontal {
            position: absolute;
            background: #9ca3af;
            z-index: 1;
        }
        
        .horizontal-line {
            height: 2px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .vertical-line-horizontal {
            width: 2px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .expandable-content-horizontal {
            max-width: 0;
            overflow: hidden;
            transition: max-width 0.3s ease-out;
            display: flex;
            align-items: flex-start;
        }
        
        .expandable-content-horizontal.expanded {
            max-width: 2000px;
        }
        
        .expandable-content-vertical {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .expandable-content-vertical.expanded {
            max-height: 2000px;
        }
        
        .org-container-vertical {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .connecting-line-vertical {
            position: absolute;
            background: #9ca3af;
            z-index: 1;
        }
        
        .vertical-line-down {
            width: 2px;
            height: 30px;
            left: 50%;
            transform: translateX(-50%);
            top: 100%;
        }
        
        .expand-indicator {
            position: absolute;
            bottom: -8px;
            right: -8px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .expand-indicator:hover {
            background: #2563eb;
            transform: scale(1.1);
        }
        
        .job-count {
            background: #ef4444;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: bold;
            margin-top: 4px;
            display: inline-block;
        }
        
        .nav-header {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .search-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .org-node-container {
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .connection-line {
            width: 40px;
            height: 2px;
            background: #9ca3af;
            margin: 0 -2px;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @media (max-width: 768px) {
            .horizontal-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .org-column {
                min-width: 200px;
            }
            
            .org-box {
                min-width: 160px;
                max-width: 200px;
                padding: 10px;
            }
            
            .connection-line {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üè¢</div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">PLDT/SMART</h1>
                <h2 class="text-xl text-gray-600">Organizational Chart</h2>
                <p class="text-sm text-gray-500 mt-2">Please enter your access code to continue</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Access Code</label>
                    <input type="password" id="passwordInput" placeholder="Enter your access code" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg tracking-widest"
                           onkeypress="handlePasswordKeyPress(event)">
                </div>
                
                <button onclick="checkPassword()" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg">
                    üîì Access Chart
                </button>
                
                <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-center">
                    <div class="flex items-center justify-center">
                        <span class="text-xl mr-2">‚ùå</span>
                        <span>Invalid access code. Please try again.</span>
                    </div>
                </div>
                

            </div>
        </div>
    </div>

    <!-- Main Application (Hidden until login) -->
    <div id="mainApp" class="hidden">
        <!-- Access Level Indicator -->
        <div id="accessIndicator" class="fixed top-4 right-4 z-40 bg-white rounded-lg shadow-lg px-4 py-2 border-l-4">
            <div class="flex items-center space-x-2">
                <span id="accessIcon"></span>
                <div>
                    <div id="accessLevel" class="font-medium text-sm"></div>
                    <div class="text-xs text-gray-500">
                        <span id="accessUser"></span> ‚Ä¢ 
                        <button onclick="logout()" class="text-blue-600 hover:text-blue-800">Logout</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Header -->
        <div class="nav-header">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h1 class="text-4xl font-bold mb-2">üè¢ PLDT/SMART Organizational Chart</h1>
            <p class="text-blue-100 text-lg">Toggle between horizontal and vertical layouts - Click on any box to expand departments</p>
        </div>
    </div>

    <!-- Search and Controls -->
    <div class="max-w-7xl mx-auto px-4">
        <div class="search-container">
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                <div class="flex-1 max-w-md">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="Search positions, departments..." 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="flex gap-3 flex-wrap">
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button id="horizontalBtn" onclick="setLayout('horizontal')" class="px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 text-white">
                            ‚ÜîÔ∏è Horizontal
                        </button>
                        <button id="verticalBtn" onclick="setLayout('vertical')" class="px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800">
                            ‚ÜïÔ∏è Vertical
                        </button>
                    </div>
                    <button onclick="expandAll()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                        üìà Expand All
                    </button>
                    <button onclick="collapseAll()" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium">
                        üìâ Collapse All
                    </button>
                    <button onclick="exportChart()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        üì§ Export
                    </button>
                    <button onclick="openCustomizer()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium">
                        üé® Customize
                    </button>
                    <div id="adminControls" class="hidden">
                        <label for="excelUpload" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium cursor-pointer">
                            üìÅ Upload Excel
                            <input type="file" id="excelUpload" accept=".xlsx,.xls" class="hidden" onchange="handleExcelUpload(event)">
                        </label>
                        <button onclick="downloadTemplate()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium">
                            üìã Download Template
                        </button>
                    </div>
                </div>
            </div>
            <div class="mt-4 text-center">
                <span class="text-gray-600">Total Positions: </span>
                <span id="totalCount" class="font-bold text-blue-600">0</span>
            </div>
        </div>

        <!-- Horizontal Organizational Chart -->
        <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
            <div id="orgChart" class="horizontal-container">
                <!-- Chart will be generated here -->
            </div>
        </div>
    </div>
    </div>

    <!-- Interface Customizer Modal -->
    <div id="customizerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-xl">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">üé® Interface Customizer</h2>
                        <p class="text-lg text-gray-600">Customize the appearance without changing code</p>
                        <div class="mt-2 inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800 border border-green-200">
                            <span class="mr-1">‚öôÔ∏è</span>
                            <span class="font-medium">Administrator Access Required</span>
                        </div>
                    </div>
                    <button onclick="closeCustomizer()" class="text-gray-500 hover:text-gray-700 text-3xl font-light">√ó</button>
                </div>
            </div>
            <div class="p-6">
                <!-- Tab Navigation -->
                <div class="flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg">
                    <button onclick="switchCustomizerTab('basic')" id="basicTab" class="flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm">
                        üé® Basic
                    </button>
                    <button onclick="switchCustomizerTab('branding')" id="brandingTab" class="flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800">
                        üè¢ Branding
                    </button>
                    <button onclick="switchCustomizerTab('layout')" id="layoutTab" class="flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800">
                        üìê Layout
                    </button>
                    <button onclick="switchCustomizerTab('advanced')" id="advancedTab" class="flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800">
                        ‚ö° Advanced
                    </button>
                </div>

                <!-- Basic Tab -->
                <div id="basicTabContent" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Color Themes -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üåà Color Themes</h3>
                            <div class="space-y-3">
                                <button onclick="applyTheme('default')" class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 transition-colors text-left">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex space-x-1">
                                            <div class="w-4 h-4 bg-blue-600 rounded"></div>
                                            <div class="w-4 h-4 bg-purple-600 rounded"></div>
                                            <div class="w-4 h-4 bg-red-600 rounded"></div>
                                        </div>
                                        <span class="font-medium">Default PLDT Theme</span>
                                    </div>
                                </button>
                                <button onclick="applyTheme('corporate')" class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 transition-colors text-left">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex space-x-1">
                                            <div class="w-4 h-4 bg-gray-700 rounded"></div>
                                            <div class="w-4 h-4 bg-gray-600 rounded"></div>
                                            <div class="w-4 h-4 bg-gray-500 rounded"></div>
                                        </div>
                                        <span class="font-medium">Corporate Gray</span>
                                    </div>
                                </button>
                                <button onclick="applyTheme('modern')" class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 transition-colors text-left">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex space-x-1">
                                            <div class="w-4 h-4 bg-emerald-600 rounded"></div>
                                            <div class="w-4 h-4 bg-teal-600 rounded"></div>
                                            <div class="w-4 h-4 bg-cyan-600 rounded"></div>
                                        </div>
                                        <span class="font-medium">Modern Teal</span>
                                    </div>
                                </button>
                                <button onclick="applyTheme('warm')" class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 transition-colors text-left">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex space-x-1">
                                            <div class="w-4 h-4 bg-orange-600 rounded"></div>
                                            <div class="w-4 h-4 bg-amber-600 rounded"></div>
                                            <div class="w-4 h-4 bg-yellow-600 rounded"></div>
                                        </div>
                                        <span class="font-medium">Warm Orange</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Font Options -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üî§ Typography</h3>
                            <div class="space-y-3">
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Font Size</label>
                                    <select id="fontSize" onchange="changeFontSize()" class="w-full p-2 border border-gray-300 rounded-lg">
                                        <option value="small">Small</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="large">Large</option>
                                        <option value="extra-large">Extra Large</option>
                                    </select>
                                </div>
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Font Style</label>
                                    <select id="fontStyle" onchange="changeFontStyle()" class="w-full p-2 border border-gray-300 rounded-lg">
                                        <option value="system">System Default</option>
                                        <option value="modern">Modern (Inter)</option>
                                        <option value="classic">Classic (Times)</option>
                                        <option value="tech">Tech (Mono)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Branding Tab -->
                <div id="brandingTabContent" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Header Customization -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üè¢ Header & Branding</h3>
                            <div class="space-y-4">
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Company Logo</label>
                                    <div class="flex items-center space-x-3">
                                        <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)" class="hidden">
                                        <button onclick="document.getElementById('logoUpload').click()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                            üìÅ Upload Logo
                                        </button>
                                        <button onclick="removeLogo()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                            üóëÔ∏è Remove
                                        </button>
                                    </div>
                                    <div id="logoPreview" class="mt-3 hidden">
                                        <img id="logoImage" src="" alt="Logo Preview" class="max-h-16 rounded border">
                                    </div>
                                </div>
                                
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Header Title</label>
                                    <input type="text" id="headerTitle" value="PLDT/SMART Organizational Chart" onchange="updateHeaderTitle()" class="w-full p-2 border border-gray-300 rounded-lg">
                                </div>
                                
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Header Subtitle</label>
                                    <textarea id="headerSubtitle" onchange="updateHeaderSubtitle()" class="w-full p-2 border border-gray-300 rounded-lg h-20">Toggle between horizontal and vertical layouts - Click on any box to expand departments</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Background Customization -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üé® Background & Colors</h3>
                            <div class="space-y-4">
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Page Background</label>
                                    <select id="backgroundColor" onchange="changeBackground()" class="w-full p-2 border border-gray-300 rounded-lg">
                                        <option value="from-blue-50 to-indigo-100">Blue Gradient (Default)</option>
                                        <option value="from-gray-50 to-gray-100">Light Gray</option>
                                        <option value="from-green-50 to-emerald-100">Green Gradient</option>
                                        <option value="from-purple-50 to-violet-100">Purple Gradient</option>
                                        <option value="from-orange-50 to-amber-100">Orange Gradient</option>
                                        <option value="bg-white">Pure White</option>
                                        <option value="bg-gray-900">Dark Mode</option>
                                    </select>
                                </div>
                                
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Header Background</label>
                                    <select id="headerBackground" onchange="changeHeaderBackground()" class="w-full p-2 border border-gray-300 rounded-lg">
                                        <option value="from-blue-600 to-indigo-700">Blue Gradient (Default)</option>
                                        <option value="from-gray-800 to-gray-900">Dark Gray</option>
                                        <option value="from-green-600 to-emerald-700">Green Gradient</option>
                                        <option value="from-purple-600 to-violet-700">Purple Gradient</option>
                                        <option value="from-orange-600 to-amber-700">Orange Gradient</option>
                                        <option value="bg-black">Pure Black</option>
                                        <option value="bg-white text-gray-800">White Header</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Layout Tab -->
                <div id="layoutTabContent" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Layout Options -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üìê Layout Options</h3>
                            <div class="space-y-3">
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="compactMode" onchange="toggleCompactMode()" class="w-4 h-4 text-blue-600">
                                        <span class="font-medium">Compact Mode</span>
                                    </label>
                                    <p class="text-sm text-gray-600 mt-1">Smaller boxes and reduced spacing</p>
                                </div>
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="showJobCounts" onchange="toggleJobCounts()" class="w-4 h-4 text-blue-600" checked>
                                        <span class="font-medium">Show Position Counts</span>
                                    </label>
                                    <p class="text-sm text-gray-600 mt-1">Display number of positions in each department</p>
                                </div>
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="showLevels" onchange="toggleLevels()" class="w-4 h-4 text-blue-600" checked>
                                        <span class="font-medium">Show Job Levels</span>
                                    </label>
                                    <p class="text-sm text-gray-600 mt-1">Display job level descriptions</p>
                                </div>
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="connectionLines" onchange="toggleConnectionLines()" class="w-4 h-4 text-blue-600" checked>
                                        <span class="font-medium">Connection Lines</span>
                                    </label>
                                    <p class="text-sm text-gray-600 mt-1">Show lines connecting organizational boxes</p>
                                </div>
                            </div>
                        </div>

                        <!-- Spacing & Style -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üìè Spacing & Style</h3>
                            <div class="space-y-3">
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Layout Spacing</label>
                                    <select id="layoutSpacing" onchange="changeLayoutSpacing()" class="w-full p-2 border border-gray-300 rounded-lg">
                                        <option value="tight">Tight</option>
                                        <option value="normal" selected>Normal</option>
                                        <option value="relaxed">Relaxed</option>
                                        <option value="loose">Loose</option>
                                    </select>
                                </div>
                                
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Border Radius</label>
                                    <select id="borderRadius" onchange="changeBorderRadius()" class="w-full p-2 border border-gray-300 rounded-lg">
                                        <option value="none">Sharp Corners</option>
                                        <option value="small">Small Radius</option>
                                        <option value="normal" selected>Normal Radius</option>
                                        <option value="large">Large Radius</option>
                                        <option value="full">Rounded Pills</option>
                                    </select>
                                </div>
                                
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Box Shadow</label>
                                    <select id="boxShadow" onchange="changeBoxShadow()" class="w-full p-2 border border-gray-300 rounded-lg">
                                        <option value="none">No Shadow</option>
                                        <option value="small">Small Shadow</option>
                                        <option value="normal" selected>Normal Shadow</option>
                                        <option value="large">Large Shadow</option>
                                        <option value="extra-large">Extra Large Shadow</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Tab -->
                <div id="advancedTabContent" class="tab-content hidden">
                    <div class="grid grid-cols-1 gap-8">
                        <!-- Drag & Drop -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üéØ Interactive Features</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="enableAnimations" onchange="toggleAnimations()" class="w-4 h-4 text-blue-600" checked>
                                        <span class="font-medium">Enable Hover Effects</span>
                                    </label>
                                    <p class="text-sm text-gray-600 mt-1">Smooth transitions and hover animations</p>
                                </div>
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="enableShadows" onchange="toggleShadows()" class="w-4 h-4 text-blue-600" checked>
                                        <span class="font-medium">Box Shadows</span>
                                    </label>
                                    <p class="text-sm text-gray-600 mt-1">Add depth with shadow effects</p>
                                </div>
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" id="dragDropEnabled" onchange="toggleDragDrop()" class="w-4 h-4 text-blue-600">
                                        <span class="font-medium">Drag & Drop Mode</span>
                                    </label>
                                    <p class="text-sm text-gray-600 mt-1">Enable repositioning of organizational boxes</p>
                                </div>
                                <div class="p-4 border border-gray-200 rounded-lg">
                                    <button onclick="toggleEditMode()" id="editModeBtn" class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                        ‚úèÔ∏è Enter Edit Mode
                                    </button>
                                    <p class="text-sm text-gray-600 mt-1">Click to edit box content directly</p>
                                </div>
                            </div>
                        </div>

                        <!-- Custom CSS -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üíª Custom CSS</h3>
                            <div class="p-4 border border-gray-200 rounded-lg">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Custom CSS Rules</label>
                                <textarea id="customCSS" onchange="applyCustomCSS()" placeholder="/* Add your custom CSS here */
.org-box {
    /* Custom styles */
}

.nav-header {
    /* Header customization */
}" class="w-full p-3 border border-gray-300 rounded-lg font-mono text-sm h-40"></textarea>
                                <p class="text-sm text-gray-600 mt-2">‚ö†Ô∏è Advanced users only. Invalid CSS may break the layout.</p>
                            </div>
                        </div>

                        <!-- Export/Import Settings -->
                        <div class="space-y-4">
                            <h3 class="text-xl font-semibold text-gray-800">üì¶ Settings Management</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button onclick="exportSettings()" class="px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    üì§ Export Settings
                                </button>
                                <label for="importSettings" class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors cursor-pointer text-center">
                                    üì• Import Settings
                                    <input type="file" id="importSettings" accept=".json" onchange="importSettings(event)" class="hidden">
                                </label>
                                <button onclick="generateHTML()" class="px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                    üîß Generate HTML
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200">
                    <div class="flex justify-between items-center">
                        <button onclick="resetToDefault()" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium">
                            üîÑ Reset to Default
                        </button>
                        <div class="space-x-3">
                            <button onclick="saveCustomization()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                                üíæ Save Settings
                            </button>
                            <button onclick="closeCustomizer()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                ‚úÖ Apply & Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Description Modal -->
    <div id="jobModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-xl">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 id="jobTitle" class="text-2xl font-bold text-gray-800 mb-2"></h2>
                        <p id="jobLevel" class="text-lg text-gray-600"></p>
                    </div>
                    <button onclick="closeJobModal()" class="text-gray-500 hover:text-gray-700 text-3xl font-light">√ó</button>
                </div>
            </div>
            <div class="p-6">
                <div id="jobContent" class="prose max-w-none">
                    <!-- Job description content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // PLDT/SMART ORGANIZATIONAL DATA
        // ========================================
        
        const organizationalData = {
            // Top Level - Board of Directors
            board: {
                id: 'board',
                title: 'üì¶ Board of Directors',
                level: 'Board Level',
                type: 'board',
                children: ['internal-audit', 'corporate-governance', 'president-ceo']
            },
            
            // Governance Units reporting to Board
            'internal-audit': {
                id: 'internal-audit',
                title: 'Internal Audit',
                level: 'Governance Unit',
                type: 'shared-services',
                children: ['internal-audit-head']
            },
            
            'corporate-governance': {
                id: 'corporate-governance',
                title: 'Corporate Governance',
                level: 'Governance Unit',
                type: 'shared-services',
                children: ['corp-gov-head']
            },
            
            // Second Level - President & CEO
            'president-ceo': {
                id: 'president-ceo',
                title: 'üì¶ President & CEO',
                level: 'Chief Executive',
                type: 'executive',
                children: ['leadership-transition', 'pldt-coo', 'smart-coo', 'consumer-home', 'fixed-sales', 'consumer-wireless', 'wireless-sales', 'enterprise-business', 'technology', 'supply-chain', 'finance-sustainability', 'people-group', 'corporate-communications', 'legal-regulatory']
            },
            
            // Vertical positions under President & CEO
            'leadership-transition': {
                id: 'leadership-transition',
                title: 'Leadership Transition Officer',
                level: 'Executive Position',
                type: 'executive',
                children: ['lt-manager', 'lt-specialist']
            },
            
            'pldt-coo': {
                id: 'pldt-coo',
                title: 'PLDT Chief Operations Officer',
                level: 'Chief Operations Officer',
                type: 'pldt-ops',
                children: ['pldt-ops-head', 'pldt-strategy-head']
            },
            
            'smart-coo': {
                id: 'smart-coo',
                title: 'SMART Chief Operations Officer',
                level: 'Chief Operations Officer',
                type: 'smart-ops',
                children: ['smart-ops-head', 'smart-strategy-head']
            },
            
            // Horizontal Business Units under President & CEO (with example hierarchies)
            'consumer-home': {
                id: 'consumer-home',
                title: 'Consumer Business Home',
                level: 'Business Unit',
                type: 'pldt-ops',
                children: ['cbh-head', 'cbh-marketing', 'cbh-operations']
            },
            
            'fixed-sales': {
                id: 'fixed-sales',
                title: 'Fixed Sales and Development',
                level: 'Business Unit',
                type: 'pldt-ops',
                children: ['fsd-head', 'fsd-sales-manager', 'fsd-dev-manager']
            },
            
            'consumer-wireless': {
                id: 'consumer-wireless',
                title: 'Consumer Business Wireless',
                level: 'Business Unit',
                type: 'smart-ops',
                children: ['cbw-head', 'cbw-marketing', 'cbw-operations']
            },
            
            'wireless-sales': {
                id: 'wireless-sales',
                title: 'Wireless Sales and Development',
                level: 'Business Unit',
                type: 'smart-ops',
                children: ['wsd-head', 'wsd-sales-manager', 'wsd-dev-manager']
            },
            
            'enterprise-business': {
                id: 'enterprise-business',
                title: 'Enterprise Business',
                level: 'Business Unit',
                type: 'shared-services',
                children: ['eb-head', 'eb-sales-head', 'eb-solutions-head']
            },
            
            // Technology with complete hierarchy example
            technology: {
                id: 'technology',
                title: 'Technology',
                level: 'Business Unit',
                type: 'shared-services',
                children: ['network-group', 'information-technology', 'cyber-security-ops']
            },
            
            'network-group': {
                id: 'network-group',
                title: 'Network Group',
                level: 'Technology Unit',
                type: 'sub-function',
                children: ['ng-head', 'ng-planning', 'ng-operations']
            },
            
            'information-technology': {
                id: 'information-technology',
                title: 'Information Technology',
                level: 'Technology Unit',
                type: 'sub-function',
                children: ['it-head', 'it-infrastructure', 'it-applications']
            },
            
            'cyber-security-ops': {
                id: 'cyber-security-ops',
                title: 'Cyber Security Operations',
                level: 'Technology Unit',
                type: 'sub-function',
                children: ['cso-head', 'cso-analyst', 'cso-engineer']
            },
            
            'supply-chain': {
                id: 'supply-chain',
                title: 'Supply Chain Management and Privacy Office',
                level: 'Business Unit',
                type: 'shared-services',
                children: ['scm-head', 'privacy-officer']
            },
            
            'finance-sustainability': {
                id: 'finance-sustainability',
                title: 'Finance and Corporate Sustainability',
                level: 'Business Unit',
                type: 'shared-services',
                children: ['finance-head', 'sustainability-head', 'fp-and-a', 'accounting']
            },
            
            'people-group': {
                id: 'people-group',
                title: 'People Group',
                level: 'Business Unit',
                type: 'shared-services',
                children: ['hr-head', 'talent-acquisition', 'learning-dev', 'compensation']
            },
            
            'corporate-communications': {
                id: 'corporate-communications',
                title: 'Corporate Communications',
                level: 'Business Unit',
                type: 'shared-services',
                children: ['comms-head', 'internal-comms', 'external-comms']
            },
            
            'legal-regulatory': {
                id: 'legal-regulatory',
                title: 'Legal and Regulatory',
                level: 'Business Unit',
                type: 'shared-services',
                children: ['legal-head', 'regulatory-head', 'compliance-officer']
            },
            
            // ========================================
            // EXAMPLE HIERARCHIES - LEVEL 2 POSITIONS
            // ========================================
            
            // Internal Audit hierarchy
            'internal-audit-head': {
                id: 'internal-audit-head',
                title: 'Head - Internal Audit',
                level: 'Department Head',
                type: 'avp',
                children: ['ia-senior-manager', 'ia-risk-manager']
            },
            
            'corp-gov-head': {
                id: 'corp-gov-head',
                title: 'Head - Corporate Governance',
                level: 'Department Head',
                type: 'avp',
                children: ['cg-manager', 'cg-analyst']
            },
            
            // Leadership Transition hierarchy
            'lt-manager': {
                id: 'lt-manager',
                title: 'Manager - Leadership Development',
                level: 'Manager',
                type: 'senior-manager',
                children: ['lt-specialist-1', 'lt-specialist-2']
            },
            
            'lt-specialist': {
                id: 'lt-specialist',
                title: 'Leadership Transition Specialist',
                level: 'Specialist',
                type: 'officer',
                children: []
            },
            
            // PLDT COO hierarchy
            'pldt-ops-head': {
                id: 'pldt-ops-head',
                title: 'Head - PLDT Operations',
                level: 'Operations Head',
                type: 'avp',
                children: ['pldt-ops-manager-1', 'pldt-ops-manager-2']
            },
            
            'pldt-strategy-head': {
                id: 'pldt-strategy-head',
                title: 'Head - PLDT Strategy',
                level: 'Strategy Head',
                type: 'avp',
                children: ['pldt-strategy-manager']
            },
            
            // SMART COO hierarchy
            'smart-ops-head': {
                id: 'smart-ops-head',
                title: 'Head - SMART Operations',
                level: 'Operations Head',
                type: 'avp',
                children: ['smart-ops-manager-1', 'smart-ops-manager-2']
            },
            
            'smart-strategy-head': {
                id: 'smart-strategy-head',
                title: 'Head - SMART Strategy',
                level: 'Strategy Head',
                type: 'avp',
                children: ['smart-strategy-manager']
            },
            
            // Consumer Business Home hierarchy
            'cbh-head': {
                id: 'cbh-head',
                title: 'Head - Consumer Business Home',
                level: 'Business Head',
                type: 'avp',
                children: ['cbh-avp-marketing', 'cbh-avp-operations']
            },
            
            'cbh-marketing': {
                id: 'cbh-marketing',
                title: 'Marketing Manager - Home',
                level: 'Marketing Manager',
                type: 'senior-manager',
                children: ['cbh-marketing-officer-1', 'cbh-marketing-officer-2']
            },
            
            'cbh-operations': {
                id: 'cbh-operations',
                title: 'Operations Manager - Home',
                level: 'Operations Manager',
                type: 'senior-manager',
                children: ['cbh-ops-officer-1', 'cbh-ops-officer-2']
            },
            
            // Finance complete hierarchy example
            'finance-head': {
                id: 'finance-head',
                title: 'Head - Finance',
                level: 'Finance Head',
                type: 'avp',
                children: ['finance-controller', 'finance-treasury']
            },
            
            'sustainability-head': {
                id: 'sustainability-head',
                title: 'Head - Corporate Sustainability',
                level: 'Sustainability Head',
                type: 'avp',
                children: ['sustainability-manager']
            },
            
            'fp-and-a': {
                id: 'fp-and-a',
                title: 'Financial Planning & Analysis',
                level: 'FP&A Department',
                type: 'senior-manager',
                children: ['fpa-manager', 'fpa-analyst-1', 'fpa-analyst-2']
            },
            
            'accounting': {
                id: 'accounting',
                title: 'Accounting Department',
                level: 'Accounting Department',
                type: 'senior-manager',
                children: ['accounting-manager', 'accounting-officer-1', 'accounting-officer-2']
            },
            
            // ========================================
            // EXAMPLE HIERARCHIES - LEVEL 3 POSITIONS
            // ========================================
            
            // Internal Audit Level 3
            'ia-senior-manager': {
                id: 'ia-senior-manager',
                title: 'Senior Manager - Internal Audit',
                level: 'Senior Manager',
                type: 'senior-manager',
                children: ['ia-officer-1', 'ia-officer-2', 'ia-staff-1']
            },
            
            'ia-risk-manager': {
                id: 'ia-risk-manager',
                title: 'Risk Manager',
                level: 'Risk Manager',
                type: 'senior-manager',
                children: ['ia-risk-officer', 'ia-risk-analyst']
            },
            
            // Finance Level 3
            'finance-controller': {
                id: 'finance-controller',
                title: 'Finance Controller',
                level: 'Controller',
                type: 'senior-manager',
                children: ['controller-officer-1', 'controller-officer-2']
            },
            
            'finance-treasury': {
                id: 'finance-treasury',
                title: 'Treasury Manager',
                level: 'Treasury Manager',
                type: 'senior-manager',
                children: ['treasury-officer', 'treasury-analyst']
            },
            
            'fpa-manager': {
                id: 'fpa-manager',
                title: 'Manager - Financial Planning',
                level: 'Manager',
                type: 'senior-manager',
                children: ['fpa-officer-1', 'fpa-officer-2']
            },
            
            // ========================================
            // EXAMPLE HIERARCHIES - LEVEL 4 POSITIONS (Staff Level)
            // ========================================
            
            // Internal Audit Staff
            'ia-officer-1': {
                id: 'ia-officer-1',
                title: 'Officer - Internal Audit',
                level: 'Officer',
                type: 'officer',
                children: ['ia-staff-audit-1', 'ia-staff-audit-2']
            },
            
            'ia-officer-2': {
                id: 'ia-officer-2',
                title: 'Officer - Compliance Audit',
                level: 'Officer',
                type: 'officer',
                children: ['ia-staff-compliance-1']
            },
            
            'ia-staff-1': {
                id: 'ia-staff-1',
                title: 'Staff - Audit Assistant',
                level: 'Staff',
                type: 'staff',
                children: []
            },
            
            // Finance Staff
            'controller-officer-1': {
                id: 'controller-officer-1',
                title: 'Officer - Financial Reporting',
                level: 'Officer',
                type: 'officer',
                children: ['fr-staff-1', 'fr-staff-2']
            },
            
            'fpa-officer-1': {
                id: 'fpa-officer-1',
                title: 'Officer - Budget Planning',
                level: 'Officer',
                type: 'officer',
                children: ['budget-staff-1', 'budget-staff-2']
            },
            
            // ========================================
            // LEVEL 5 POSITIONS (Individual Contributors)
            // ========================================
            
            'ia-staff-audit-1': {
                id: 'ia-staff-audit-1',
                title: 'Staff - Junior Auditor',
                level: 'Staff',
                type: 'staff',
                children: []
            },
            
            'ia-staff-audit-2': {
                id: 'ia-staff-audit-2',
                title: 'Staff - Audit Analyst',
                level: 'Staff',
                type: 'staff',
                children: []
            },
            
            'fr-staff-1': {
                id: 'fr-staff-1',
                title: 'Staff - Financial Analyst',
                level: 'Staff',
                type: 'staff',
                children: []
            },
            
            'fr-staff-2': {
                id: 'fr-staff-2',
                title: 'Staff - Reporting Specialist',
                level: 'Staff',
                type: 'staff',
                children: []
            },
            
            'budget-staff-1': {
                id: 'budget-staff-1',
                title: 'Staff - Budget Analyst',
                level: 'Staff',
                type: 'staff',
                children: []
            },
            
            'budget-staff-2': {
                id: 'budget-staff-2',
                title: 'Staff - Planning Analyst',
                level: 'Staff',
                type: 'staff',
                children: []
            },
            
            // Placeholder positions for other departments (you can expand these)
            'ng-head': { id: 'ng-head', title: 'Head - Network Group', level: 'Department Head', type: 'avp', children: [] },
            'it-head': { id: 'it-head', title: 'Head - Information Technology', level: 'Department Head', type: 'avp', children: [] },
            'cso-head': { id: 'cso-head', title: 'Head - Cyber Security', level: 'Department Head', type: 'avp', children: [] },
            'hr-head': { id: 'hr-head', title: 'Head - People Group', level: 'Department Head', type: 'avp', children: [] },
            'comms-head': { id: 'comms-head', title: 'Head - Corporate Communications', level: 'Department Head', type: 'avp', children: [] },
            'legal-head': { id: 'legal-head', title: 'Head - Legal', level: 'Department Head', type: 'avp', children: [] },
            
            // Add more positions as needed - just follow the same pattern!
            // Each position needs: id, title, level, type, children (array of child IDs)
            
            // Additional missing positions
            'lt-specialist-1': { id: 'lt-specialist-1', title: 'Leadership Specialist 1', level: 'Specialist', type: 'staff', children: [] },
            'lt-specialist-2': { id: 'lt-specialist-2', title: 'Leadership Specialist 2', level: 'Specialist', type: 'staff', children: [] },
            'pldt-ops-manager-1': { id: 'pldt-ops-manager-1', title: 'PLDT Operations Manager 1', level: 'Manager', type: 'senior-manager', children: [] },
            'pldt-ops-manager-2': { id: 'pldt-ops-manager-2', title: 'PLDT Operations Manager 2', level: 'Manager', type: 'senior-manager', children: [] },
            'pldt-strategy-manager': { id: 'pldt-strategy-manager', title: 'PLDT Strategy Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'smart-ops-manager-1': { id: 'smart-ops-manager-1', title: 'SMART Operations Manager 1', level: 'Manager', type: 'senior-manager', children: [] },
            'smart-ops-manager-2': { id: 'smart-ops-manager-2', title: 'SMART Operations Manager 2', level: 'Manager', type: 'senior-manager', children: [] },
            'smart-strategy-manager': { id: 'smart-strategy-manager', title: 'SMART Strategy Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'cbh-avp-marketing': { id: 'cbh-avp-marketing', title: 'AVP - Home Marketing', level: 'AVP', type: 'avp', children: [] },
            'cbh-avp-operations': { id: 'cbh-avp-operations', title: 'AVP - Home Operations', level: 'AVP', type: 'avp', children: [] },
            'cbh-marketing-officer-1': { id: 'cbh-marketing-officer-1', title: 'Marketing Officer 1', level: 'Officer', type: 'officer', children: [] },
            'cbh-marketing-officer-2': { id: 'cbh-marketing-officer-2', title: 'Marketing Officer 2', level: 'Officer', type: 'officer', children: [] },
            'cbh-ops-officer-1': { id: 'cbh-ops-officer-1', title: 'Operations Officer 1', level: 'Officer', type: 'officer', children: [] },
            'cbh-ops-officer-2': { id: 'cbh-ops-officer-2', title: 'Operations Officer 2', level: 'Officer', type: 'officer', children: [] },
            'fsd-head': { id: 'fsd-head', title: 'Head - Fixed Sales', level: 'Department Head', type: 'avp', children: [] },
            'fsd-sales-manager': { id: 'fsd-sales-manager', title: 'Sales Manager - Fixed', level: 'Manager', type: 'senior-manager', children: [] },
            'fsd-dev-manager': { id: 'fsd-dev-manager', title: 'Development Manager - Fixed', level: 'Manager', type: 'senior-manager', children: [] },
            'cbw-head': { id: 'cbw-head', title: 'Head - Consumer Wireless', level: 'Department Head', type: 'avp', children: [] },
            'cbw-marketing': { id: 'cbw-marketing', title: 'Marketing Manager - Wireless', level: 'Manager', type: 'senior-manager', children: [] },
            'cbw-operations': { id: 'cbw-operations', title: 'Operations Manager - Wireless', level: 'Manager', type: 'senior-manager', children: [] },
            'wsd-head': { id: 'wsd-head', title: 'Head - Wireless Sales', level: 'Department Head', type: 'avp', children: [] },
            'wsd-sales-manager': { id: 'wsd-sales-manager', title: 'Sales Manager - Wireless', level: 'Manager', type: 'senior-manager', children: [] },
            'wsd-dev-manager': { id: 'wsd-dev-manager', title: 'Development Manager - Wireless', level: 'Manager', type: 'senior-manager', children: [] },
            'eb-head': { id: 'eb-head', title: 'Head - Enterprise Business', level: 'Department Head', type: 'avp', children: [] },
            'eb-sales-head': { id: 'eb-sales-head', title: 'Head - Enterprise Sales', level: 'Sales Head', type: 'avp', children: [] },
            'eb-solutions-head': { id: 'eb-solutions-head', title: 'Head - Enterprise Solutions', level: 'Solutions Head', type: 'avp', children: [] },
            'ng-planning': { id: 'ng-planning', title: 'Network Planning Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'ng-operations': { id: 'ng-operations', title: 'Network Operations Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'it-infrastructure': { id: 'it-infrastructure', title: 'IT Infrastructure Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'it-applications': { id: 'it-applications', title: 'IT Applications Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'cso-analyst': { id: 'cso-analyst', title: 'Cyber Security Analyst', level: 'Analyst', type: 'officer', children: [] },
            'cso-engineer': { id: 'cso-engineer', title: 'Cyber Security Engineer', level: 'Engineer', type: 'officer', children: [] },
            'scm-head': { id: 'scm-head', title: 'Head - Supply Chain', level: 'Department Head', type: 'avp', children: [] },
            'privacy-officer': { id: 'privacy-officer', title: 'Privacy Officer', level: 'Officer', type: 'officer', children: [] },
            'sustainability-manager': { id: 'sustainability-manager', title: 'Sustainability Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'fpa-analyst-1': { id: 'fpa-analyst-1', title: 'FP&A Analyst 1', level: 'Analyst', type: 'staff', children: [] },
            'fpa-analyst-2': { id: 'fpa-analyst-2', title: 'FP&A Analyst 2', level: 'Analyst', type: 'staff', children: [] },
            'accounting-manager': { id: 'accounting-manager', title: 'Accounting Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'accounting-officer-1': { id: 'accounting-officer-1', title: 'Accounting Officer 1', level: 'Officer', type: 'officer', children: [] },
            'accounting-officer-2': { id: 'accounting-officer-2', title: 'Accounting Officer 2', level: 'Officer', type: 'officer', children: [] },
            'talent-acquisition': { id: 'talent-acquisition', title: 'Talent Acquisition Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'learning-dev': { id: 'learning-dev', title: 'Learning & Development Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'compensation': { id: 'compensation', title: 'Compensation Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'internal-comms': { id: 'internal-comms', title: 'Internal Communications Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'external-comms': { id: 'external-comms', title: 'External Communications Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'regulatory-head': { id: 'regulatory-head', title: 'Head - Regulatory Affairs', level: 'Department Head', type: 'avp', children: [] },
            'compliance-officer': { id: 'compliance-officer', title: 'Compliance Officer', level: 'Officer', type: 'officer', children: [] },
            'cg-manager': { id: 'cg-manager', title: 'Corporate Governance Manager', level: 'Manager', type: 'senior-manager', children: [] },
            'cg-analyst': { id: 'cg-analyst', title: 'Corporate Governance Analyst', level: 'Analyst', type: 'staff', children: [] },
            'ia-risk-officer': { id: 'ia-risk-officer', title: 'Risk Officer', level: 'Officer', type: 'officer', children: [] },
            'ia-risk-analyst': { id: 'ia-risk-analyst', title: 'Risk Analyst', level: 'Analyst', type: 'staff', children: [] },
            'controller-officer-2': { id: 'controller-officer-2', title: 'Officer - Management Reporting', level: 'Officer', type: 'officer', children: [] },
            'treasury-officer': { id: 'treasury-officer', title: 'Treasury Officer', level: 'Officer', type: 'officer', children: [] },
            'treasury-analyst': { id: 'treasury-analyst', title: 'Treasury Analyst', level: 'Analyst', type: 'staff', children: [] },
            'fpa-officer-2': { id: 'fpa-officer-2', title: 'Officer - Financial Analysis', level: 'Officer', type: 'officer', children: [] },
            'ia-staff-compliance-1': { id: 'ia-staff-compliance-1', title: 'Staff - Compliance Specialist', level: 'Staff', type: 'staff', children: [] }
        };

        // ========================================
        // JOB DESCRIPTIONS
        // ========================================
        
        const jobDescriptions = {
            'president-ceo': {
                title: 'President & CEO',
                level: 'Chief Executive Officer',
                department: 'Executive Office',
                content: `
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Position Overview</h3>
                            <p class="text-gray-700 leading-relaxed">The President & CEO provides strategic leadership for PLDT and SMART Communications, driving digital transformation and sustainable growth across telecommunications and digital services.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Key Responsibilities</h3>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>Lead strategic direction for PLDT Group companies</li>
                                <li>Oversee business units and shared services</li>
                                <li>Drive digital transformation initiatives</li>
                                <li>Ensure regulatory compliance and stakeholder relations</li>
                                <li>Champion innovation and technology advancement</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Requirements</h3>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>Advanced degree in Business, Engineering, or related field</li>
                                <li>20+ years of telecommunications industry experience</li>
                                <li>Proven track record in digital transformation</li>
                                <li>Strong leadership and strategic planning skills</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            
            'leadership-transition': {
                title: 'Leadership Transition Officer',
                level: 'Executive Position',
                department: 'Executive Office',
                content: `
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Position Overview</h3>
                            <p class="text-gray-700 leading-relaxed">The Leadership Transition Officer manages executive succession planning and leadership development initiatives across PLDT Group.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Key Responsibilities</h3>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>Develop and execute leadership succession plans</li>
                                <li>Coordinate executive development programs</li>
                                <li>Manage leadership transition processes</li>
                                <li>Support organizational change initiatives</li>
                                <li>Facilitate leadership assessments and coaching</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            
            'internal-audit': {
                title: 'Internal Audit',
                level: 'Governance Unit',
                department: 'Board Governance',
                content: `
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Position Overview</h3>
                            <p class="text-gray-700 leading-relaxed">Internal Audit provides independent assurance and consulting services to improve PLDT Group's operations and governance processes.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Key Responsibilities</h3>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>Conduct risk-based internal audits</li>
                                <li>Evaluate internal controls and compliance</li>
                                <li>Report findings to Board and Audit Committee</li>
                                <li>Monitor management action plans</li>
                                <li>Provide advisory services on governance</li>
                            </ul>
                        </div>
                    </div>
                `
            }
        };

        // ========================================
        // PASSWORD AUTHENTICATION SYSTEM
        // ========================================
        
        const ACCESS_CODES = {
            'PLDTSMART_HR_OD': {
                level: 'viewer',
                name: 'Viewer',
                icon: 'üëÄ',
                color: 'border-blue-500',
                canEdit: false
            },
            'Hunter542639': {
                level: 'admin',
                name: 'Administrator',
                icon: '‚öôÔ∏è',
                color: 'border-green-500',
                canEdit: true
            }
        };

        let currentUser = null;

        function handlePasswordKeyPress(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        }

        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('loginError');
            
            if (ACCESS_CODES[password]) {
                // Valid password
                currentUser = ACCESS_CODES[password];
                showMainApp();
                errorDiv.classList.add('hidden');
            } else {
                // Invalid password
                errorDiv.classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                
                // Shake animation
                const loginScreen = document.getElementById('loginScreen');
                loginScreen.style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => {
                    loginScreen.style.animation = '';
                }, 500);
            }
        }

        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update access indicator
            const indicator = document.getElementById('accessIndicator');
            const icon = document.getElementById('accessIcon');
            const level = document.getElementById('accessLevel');
            const user = document.getElementById('accessUser');
            
            indicator.className = `fixed top-4 right-4 z-40 bg-white rounded-lg shadow-lg px-4 py-2 border-l-4 ${currentUser.color}`;
            icon.textContent = currentUser.icon;
            level.textContent = currentUser.name + ' Access';
            user.textContent = currentUser.level.toUpperCase();
            
            // Show/hide admin controls
            const adminControls = document.getElementById('adminControls');
            if (currentUser.canEdit) {
                adminControls.classList.remove('hidden');
            } else {
                adminControls.classList.add('hidden');
            }
            
            // Initialize the chart
            generateChart();
            setupSearch();
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').focus();
        }

        function checkAdminAccess(action) {
            if (!currentUser || !currentUser.canEdit) {
                alert(`üîí Access Denied\n\nThis action requires Administrator access.\n\nYou are currently logged in as: ${currentUser ? currentUser.name : 'Unknown'}\n\nPlease contact your system administrator for admin access.`);
                return false;
            }
            return true;
        }

        // ========================================
        // WEB APP FUNCTIONALITY
        // ========================================

        let expandedNodes = new Set();
        let currentLayout = 'horizontal';

        function createHorizontalOrgBox(nodeId, data, level = 0) {
            const hasChildren = data.children && data.children.length > 0;
            const childCount = hasChildren ? countAllChildren(nodeId) : 0;
            const isExpanded = expandedNodes.has(nodeId);
            
            return `
                <div class="org-node-container" data-node="${nodeId}">
                    <div class="org-column">
                        <div class="org-box ${data.type}" onclick="handleBoxClick('${nodeId}', '${data.type}')">
                            <div class="font-bold text-sm">${data.title}</div>
                            ${data.subtitle ? `<div class="text-xs opacity-90 mt-1">${data.subtitle}</div>` : ''}
                            <div class="text-xs mt-2 opacity-80">${data.level}</div>
                            ${childCount > 0 ? `<div class="job-count">${childCount} positions</div>` : ''}
                            ${hasChildren ? `<div class="expand-indicator" onclick="event.stopPropagation(); toggleExpand('${nodeId}')">${isExpanded ? '‚àí' : '+'}</div>` : ''}
                        </div>
                    </div>
                    ${hasChildren ? `
                        <div class="connection-line"></div>
                        <div class="expandable-content-horizontal ${isExpanded ? 'expanded' : ''}" id="content-${nodeId}">
                            <div class="org-level-horizontal">
                                ${data.children.map(childId => createHorizontalOrgBox(childId, organizationalData[childId], level + 1)).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createVerticalOrgBox(nodeId, data) {
            const hasChildren = data.children && data.children.length > 0;
            const childCount = hasChildren ? countAllChildren(nodeId) : 0;
            const isExpanded = expandedNodes.has(nodeId);
            
            return `
                <div class="org-container-vertical" data-node="${nodeId}">
                    <div class="org-box ${data.type}" onclick="handleBoxClick('${nodeId}', '${data.type}')">
                        <div class="font-bold text-lg">${data.title}</div>
                        ${data.subtitle ? `<div class="text-sm opacity-90 mt-1">${data.subtitle}</div>` : ''}
                        <div class="text-sm mt-2 opacity-80">${data.level}</div>
                        ${childCount > 0 ? `<div class="job-count">${childCount} positions</div>` : ''}
                        ${hasChildren ? `<div class="expand-indicator" onclick="event.stopPropagation(); toggleExpand('${nodeId}')">${isExpanded ? '‚àí' : '+'}</div>` : ''}
                    </div>
                    ${hasChildren ? `
                        <div class="expandable-content-vertical ${isExpanded ? 'expanded' : ''}" id="content-${nodeId}">
                            <div class="connecting-line-vertical vertical-line-down"></div>
                            <div class="org-level-vertical" style="margin-top: 30px;">
                                ${data.children.map(childId => createVerticalOrgBox(childId, organizationalData[childId])).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function countAllChildren(nodeId) {
            const node = organizationalData[nodeId];
            if (!node || !node.children) return 0;
            
            let count = 0;
            node.children.forEach(childId => {
                const child = organizationalData[childId];
                if (child.type === 'position') {
                    count++;
                }
                count += countAllChildren(childId);
            });
            return count;
        }

        function handleBoxClick(nodeId, type) {
            if (type === 'position') {
                showJobDescription(nodeId);
            } else {
                toggleExpand(nodeId);
            }
        }

        function toggleExpand(nodeId) {
            const content = document.getElementById(`content-${nodeId}`);
            const indicator = content.parentElement.querySelector('.expand-indicator');
            
            if (expandedNodes.has(nodeId)) {
                expandedNodes.delete(nodeId);
                content.classList.remove('expanded');
                indicator.textContent = '+';
            } else {
                expandedNodes.add(nodeId);
                content.classList.add('expanded');
                indicator.textContent = '‚àí';
            }
        }

        function setLayout(layout) {
            currentLayout = layout;
            
            // Update button styles
            const horizontalBtn = document.getElementById('horizontalBtn');
            const verticalBtn = document.getElementById('verticalBtn');
            
            if (layout === 'horizontal') {
                horizontalBtn.className = 'px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 text-white';
                verticalBtn.className = 'px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800';
            } else {
                verticalBtn.className = 'px-4 py-2 rounded-md text-sm font-medium transition-colors bg-blue-600 text-white';
                horizontalBtn.className = 'px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800';
            }
            
            generateChart();
        }

        function expandAll() {
            Object.keys(organizationalData).forEach(nodeId => {
                const node = organizationalData[nodeId];
                if (node.children && node.children.length > 0) {
                    expandedNodes.add(nodeId);
                }
            });
            generateChart();
        }

        function collapseAll() {
            expandedNodes.clear();
            generateChart();
        }

        function generateChart() {
            const chartContainer = document.getElementById('orgChart');
            
            if (currentLayout === 'horizontal') {
                chartContainer.className = 'horizontal-container';
                chartContainer.innerHTML = createHorizontalOrgBox('board', organizationalData['board']);
            } else {
                chartContainer.className = 'vertical-container';
                chartContainer.innerHTML = createVerticalOrgBox('board', organizationalData['board']);
            }
            
            updateTotalCount();
        }

        function updateTotalCount() {
            const totalPositions = Object.keys(organizationalData).length;
            document.getElementById('totalCount').textContent = totalPositions;
        }

        function showJobDescription(jobId) {
            const job = jobDescriptions[jobId];
            const nodeData = organizationalData[jobId];
            
            if (!job) {
                document.getElementById('jobTitle').textContent = nodeData.title;
                document.getElementById('jobLevel').textContent = `${nodeData.level} ‚Ä¢ Professional Position`;
                document.getElementById('jobContent').innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">üìã</div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Job Description Coming Soon</h3>
                        <p class="text-gray-600">Detailed job description for this position is being prepared and will be available shortly.</p>
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                            <p class="text-sm text-blue-800"><strong>Note:</strong> This is a sample organizational chart. In a real implementation, all positions would have detailed job descriptions.</p>
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('jobTitle').textContent = job.title;
                document.getElementById('jobLevel').textContent = `${job.level} ‚Ä¢ ${job.department}`;
                document.getElementById('jobContent').innerHTML = job.content;
            }
            
            document.getElementById('jobModal').classList.remove('hidden');
            document.getElementById('jobModal').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeJobModal() {
            document.getElementById('jobModal').classList.add('hidden');
            document.getElementById('jobModal').classList.remove('flex');
            document.body.style.overflow = 'auto';
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const allBoxes = document.querySelectorAll('.org-box');
                
                allBoxes.forEach(box => {
                    const text = box.textContent.toLowerCase();
                    const container = box.closest('.org-node-container');
                    
                    if (searchTerm === '' || text.includes(searchTerm)) {
                        container.style.display = '';
                        // Highlight matching text
                        if (searchTerm !== '') {
                            const titleElement = box.querySelector('.font-bold');
                            if (titleElement) {
                                const originalText = titleElement.textContent;
                                const highlightedText = originalText.replace(
                                    new RegExp(`(${searchTerm})`, 'gi'),
                                    '<span style="background-color: #fef3c7; padding: 2px 4px; border-radius: 4px;">$1</span>'
                                );
                                titleElement.innerHTML = highlightedText;
                            }
                        }
                    } else {
                        container.style.display = 'none';
                    }
                });
            });
        }

        function exportChart() {
            const data = {
                organizationalData,
                jobDescriptions,
                expandedNodes: Array.from(expandedNodes),
                exportDate: new Date().toISOString(),
                totalPositions: document.getElementById('totalCount').textContent,
                layout: 'horizontal'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'horizontal-org-chart-export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadTemplate() {
            // Create sample data for Excel template
            const templateData = [
                ['Position ID', 'Position Title', 'Level', 'Type', 'Parent ID', 'Department', 'Description'],
                ['board', 'Board of Directors', 'Board Level', 'board', '', 'Governance', 'Top level governance body'],
                ['president-ceo', 'President & CEO', 'Chief Executive', 'executive', 'board', 'Executive Office', 'Chief executive officer'],
                ['finance-head', 'Head - Finance', 'Department Head', 'avp', 'president-ceo', 'Finance', 'Finance department head'],
                ['finance-manager', 'Finance Manager', 'Manager', 'senior-manager', 'finance-head', 'Finance', 'Finance operations manager'],
                ['finance-officer', 'Finance Officer', 'Officer', 'officer', 'finance-manager', 'Finance', 'Finance operations officer'],
                ['finance-staff', 'Finance Staff', 'Staff', 'staff', 'finance-officer', 'Finance', 'Finance support staff']
            ];

            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Org Chart Template');
            
            // Set column widths
            ws['!cols'] = [
                { width: 15 }, // Position ID
                { width: 30 }, // Position Title
                { width: 20 }, // Level
                { width: 15 }, // Type
                { width: 15 }, // Parent ID
                { width: 20 }, // Department
                { width: 40 }  // Description
            ];
            
            XLSX.writeFile(wb, 'org-chart-template.xlsx');
            
            // Show instructions
            alert(`üìã Template Downloaded!

Instructions for using the Excel template:

1. Position ID: Unique identifier (no spaces, use hyphens)
2. Position Title: Display name for the position
3. Level: Job level description
4. Type: Choose from: board, executive, pldt-ops, smart-ops, shared-services, sub-function, avp, senior-manager, officer, staff
5. Parent ID: The Position ID of the direct supervisor (leave empty for top level)
6. Department: Department name
7. Description: Job description (optional)

Save as .xlsx and upload using the "Upload Excel" button!`);
        }

        function handleExcelUpload(event) {
            if (!checkAdminAccess('upload Excel file')) {
                event.target.value = ''; // Reset file input
                return;
            }
            
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    processExcelData(jsonData);
                } catch (error) {
                    alert('‚ùå Error reading Excel file: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function processExcelData(data) {
            if (data.length < 2) {
                alert('‚ùå Excel file must have at least a header row and one data row');
                return;
            }

            const headers = data[0];
            const requiredHeaders = ['Position ID', 'Position Title', 'Level', 'Type', 'Parent ID'];
            
            // Check if required headers exist
            const missingHeaders = requiredHeaders.filter(header => !headers.includes(header));
            if (missingHeaders.length > 0) {
                alert(`‚ùå Missing required columns: ${missingHeaders.join(', ')}`);
                return;
            }

            // Get column indices
            const idIndex = headers.indexOf('Position ID');
            const titleIndex = headers.indexOf('Position Title');
            const levelIndex = headers.indexOf('Level');
            const typeIndex = headers.indexOf('Type');
            const parentIndex = headers.indexOf('Parent ID');
            const deptIndex = headers.indexOf('Department');
            const descIndex = headers.indexOf('Description');

            // Clear existing data
            Object.keys(organizationalData).forEach(key => delete organizationalData[key]);
            Object.keys(jobDescriptions).forEach(key => delete jobDescriptions[key]);

            // Process each row
            const newOrgData = {};
            const newJobDescs = {};
            
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (!row[idIndex] || !row[titleIndex]) continue; // Skip empty rows

                const positionId = String(row[idIndex]).toLowerCase().replace(/\s+/g, '-');
                const parentId = row[parentIndex] ? String(row[parentIndex]).toLowerCase().replace(/\s+/g, '-') : '';
                
                // Create position data
                newOrgData[positionId] = {
                    id: positionId,
                    title: row[titleIndex] || '',
                    level: row[levelIndex] || 'Position',
                    type: row[typeIndex] || 'staff',
                    children: []
                };

                // Create job description if description provided
                if (row[descIndex]) {
                    newJobDescs[positionId] = {
                        title: row[titleIndex] || '',
                        level: row[levelIndex] || 'Position',
                        department: row[deptIndex] || 'Department',
                        content: `
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Position Overview</h3>
                                    <p class="text-gray-700 leading-relaxed">${row[descIndex]}</p>
                                </div>
                            </div>
                        `
                    };
                }
            }

            // Build parent-child relationships
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (!row[idIndex]) continue;

                const positionId = String(row[idIndex]).toLowerCase().replace(/\s+/g, '-');
                const parentId = row[parentIndex] ? String(row[parentIndex]).toLowerCase().replace(/\s+/g, '-') : '';
                
                if (parentId && newOrgData[parentId]) {
                    if (!newOrgData[parentId].children.includes(positionId)) {
                        newOrgData[parentId].children.push(positionId);
                    }
                }
            }

            // Update global data
            Object.assign(organizationalData, newOrgData);
            Object.assign(jobDescriptions, newJobDescs);

            // Find root node (position with no parent)
            let rootNode = null;
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (!row[parentIndex] || row[parentIndex] === '') {
                    rootNode = String(row[idIndex]).toLowerCase().replace(/\s+/g, '-');
                    break;
                }
            }

            // Regenerate chart
            expandedNodes.clear();
            generateChart();

            // Show success message
            const totalPositions = Object.keys(organizationalData).length;
            alert(`‚úÖ Excel file processed successfully!

üìä Imported ${totalPositions} positions
üè¢ Root position: ${rootNode ? organizationalData[rootNode].title : 'Not found'}
üìã Job descriptions: ${Object.keys(jobDescriptions).length}

The organizational chart has been updated with your Excel data!`);

            // Reset file input
            event.target.value = '';
        }

        // ========================================
        // ADVANCED INTERFACE CUSTOMIZATION SYSTEM
        // ========================================
        
        let customizationSettings = {
            theme: 'default',
            compactMode: false,
            showJobCounts: true,
            showLevels: true,
            fontSize: 'medium',
            fontStyle: 'system',
            enableAnimations: true,
            enableShadows: true,
            // New advanced settings
            headerLogo: null,
            headerTitle: 'PLDT/SMART Organizational Chart',
            headerSubtitle: 'Toggle between horizontal and vertical layouts - Click on any box to expand departments',
            backgroundColor: 'from-blue-50 to-indigo-100',
            headerBackground: 'from-blue-600 to-indigo-700',
            customCSS: '',
            layoutSpacing: 'normal',
            borderRadius: 'normal',
            boxShadow: 'normal',
            connectionLines: true,
            customColors: {},
            dragDropEnabled: false
        };

        let isDragging = false;
        let dragElement = null;
        let dragOffset = { x: 0, y: 0 };
        let editMode = false;

        function openCustomizer() {
            if (!checkAdminAccess('access customization settings')) {
                return;
            }
            
            document.getElementById('customizerModal').classList.remove('hidden');
            document.getElementById('customizerModal').classList.add('flex');
            document.body.style.overflow = 'hidden';
            
            // Load current settings
            loadCustomizationSettings();
        }

        function switchCustomizerTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.className = 'flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:text-gray-800';
            });
            
            // Show selected tab content
            document.getElementById(tabName + 'TabContent').classList.remove('hidden');
            
            // Add active class to selected tab
            document.getElementById(tabName + 'Tab').className = 'flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors bg-white text-blue-600 shadow-sm';
        }

        function closeCustomizer() {
            document.getElementById('customizerModal').classList.add('hidden');
            document.getElementById('customizerModal').classList.remove('flex');
            document.body.style.overflow = 'auto';
        }

        function loadCustomizationSettings() {
            // Load from localStorage if available
            const saved = localStorage.getItem('orgChartCustomization');
            if (saved) {
                customizationSettings = { ...customizationSettings, ...JSON.parse(saved) };
            }
            
            // Update UI controls
            document.getElementById('compactMode').checked = customizationSettings.compactMode;
            document.getElementById('showJobCounts').checked = customizationSettings.showJobCounts;
            document.getElementById('showLevels').checked = customizationSettings.showLevels;
            document.getElementById('connectionLines').checked = customizationSettings.connectionLines;
            document.getElementById('fontSize').value = customizationSettings.fontSize;
            document.getElementById('fontStyle').value = customizationSettings.fontStyle;
            document.getElementById('enableAnimations').checked = customizationSettings.enableAnimations;
            document.getElementById('enableShadows').checked = customizationSettings.enableShadows;
            document.getElementById('dragDropEnabled').checked = customizationSettings.dragDropEnabled;
            document.getElementById('headerTitle').value = customizationSettings.headerTitle;
            document.getElementById('headerSubtitle').value = customizationSettings.headerSubtitle;
            document.getElementById('backgroundColor').value = customizationSettings.backgroundColor;
            document.getElementById('headerBackground').value = customizationSettings.headerBackground;
            document.getElementById('layoutSpacing').value = customizationSettings.layoutSpacing;
            document.getElementById('borderRadius').value = customizationSettings.borderRadius;
            document.getElementById('boxShadow').value = customizationSettings.boxShadow;
            document.getElementById('customCSS').value = customizationSettings.customCSS;
            
            // Apply current settings
            applyAllCustomizations();
        }

        // ========================================
        // NEW CUSTOMIZATION FUNCTIONS
        // ========================================

        function handleLogoUpload(event) {
            if (!checkAdminAccess('upload logo')) {
                event.target.value = '';
                return;
            }
            
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                customizationSettings.headerLogo = e.target.result;
                document.getElementById('logoImage').src = e.target.result;
                document.getElementById('logoPreview').classList.remove('hidden');
                applyHeaderLogo();
            };
            reader.readAsDataURL(file);
        }

        function removeLogo() {
            if (!checkAdminAccess('remove logo')) return;
            
            customizationSettings.headerLogo = null;
            document.getElementById('logoPreview').classList.add('hidden');
            applyHeaderLogo();
        }

        function applyHeaderLogo() {
            const headerContent = document.querySelector('.nav-header .max-w-7xl');
            const existingLogo = document.getElementById('headerLogo');
            
            if (existingLogo) {
                existingLogo.remove();
            }
            
            if (customizationSettings.headerLogo) {
                const logoElement = document.createElement('img');
                logoElement.id = 'headerLogo';
                logoElement.src = customizationSettings.headerLogo;
                logoElement.className = 'h-12 w-auto mx-auto mb-4';
                logoElement.alt = 'Company Logo';
                
                headerContent.insertBefore(logoElement, headerContent.firstChild);
            }
        }

        function updateHeaderTitle() {
            if (!checkAdminAccess('update header title')) {
                document.getElementById('headerTitle').value = customizationSettings.headerTitle;
                return;
            }
            
            customizationSettings.headerTitle = document.getElementById('headerTitle').value;
            applyHeaderTitle();
        }

        function applyHeaderTitle() {
            const titleElement = document.querySelector('.nav-header h1');
            if (titleElement) {
                titleElement.textContent = customizationSettings.headerTitle;
            }
        }

        function updateHeaderSubtitle() {
            if (!checkAdminAccess('update header subtitle')) {
                document.getElementById('headerSubtitle').value = customizationSettings.headerSubtitle;
                return;
            }
            
            customizationSettings.headerSubtitle = document.getElementById('headerSubtitle').value;
            applyHeaderSubtitle();
        }

        function applyHeaderSubtitle() {
            const subtitleElement = document.querySelector('.nav-header p');
            if (subtitleElement) {
                subtitleElement.textContent = customizationSettings.headerSubtitle;
            }
        }

        function changeBackground() {
            if (!checkAdminAccess('change background')) {
                document.getElementById('backgroundColor').value = customizationSettings.backgroundColor;
                return;
            }
            
            customizationSettings.backgroundColor = document.getElementById('backgroundColor').value;
            applyBackground();
        }

        function applyBackground() {
            const body = document.body;
            // Remove existing background classes
            body.className = body.className.replace(/bg-\S+/g, '').replace(/from-\S+/g, '').replace(/to-\S+/g, '');
            
            if (customizationSettings.backgroundColor.includes('gradient')) {
                body.className += ` bg-gradient-to-br ${customizationSettings.backgroundColor}`;
            } else {
                body.className += ` ${customizationSettings.backgroundColor}`;
            }
            
            // Handle dark mode text
            if (customizationSettings.backgroundColor === 'bg-gray-900') {
                body.style.color = 'white';
            } else {
                body.style.color = '';
            }
        }

        function changeHeaderBackground() {
            if (!checkAdminAccess('change header background')) {
                document.getElementById('headerBackground').value = customizationSettings.headerBackground;
                return;
            }
            
            customizationSettings.headerBackground = document.getElementById('headerBackground').value;
            applyHeaderBackground();
        }

        function applyHeaderBackground() {
            const header = document.querySelector('.nav-header');
            if (!header) return;
            
            // Remove existing classes
            header.className = 'nav-header color-white padding-20px-0 margin-bottom-30px';
            
            if (customizationSettings.headerBackground.includes('gradient')) {
                header.className += ` bg-gradient-to-r ${customizationSettings.headerBackground}`;
            } else {
                header.className += ` ${customizationSettings.headerBackground}`;
            }
        }

        function toggleConnectionLines() {
            if (!checkAdminAccess('toggle connection lines')) {
                document.getElementById('connectionLines').checked = customizationSettings.connectionLines;
                return;
            }
            
            customizationSettings.connectionLines = document.getElementById('connectionLines').checked;
            applyConnectionLines();
        }

        function applyConnectionLines() {
            const style = document.createElement('style');
            style.id = 'connectionlines-override';
            
            const existing = document.getElementById('connectionlines-override');
            if (existing) existing.remove();
            
            if (!customizationSettings.connectionLines) {
                style.textContent = `
                    .connection-line,
                    .connecting-line-horizontal,
                    .connecting-line-vertical {
                        display: none !important;
                    }
                `;
            }
            
            document.head.appendChild(style);
        }

        function changeLayoutSpacing() {
            if (!checkAdminAccess('change layout spacing')) {
                document.getElementById('layoutSpacing').value = customizationSettings.layoutSpacing;
                return;
            }
            
            customizationSettings.layoutSpacing = document.getElementById('layoutSpacing').value;
            applyLayoutSpacing();
        }

        function applyLayoutSpacing() {
            const spacings = {
                tight: { gap: '10px', margin: '4px', padding: '8px' },
                normal: { gap: '20px', margin: '8px', padding: '12px' },
                relaxed: { gap: '30px', margin: '12px', padding: '16px' },
                loose: { gap: '40px', margin: '16px', padding: '20px' }
            };
            
            const spacing = spacings[customizationSettings.layoutSpacing];
            
            const style = document.createElement('style');
            style.id = 'spacing-override';
            
            const existing = document.getElementById('spacing-override');
            if (existing) existing.remove();
            
            style.textContent = `
                .horizontal-container {
                    gap: ${spacing.gap} !important;
                }
                .org-box {
                    margin: ${spacing.margin} !important;
                    padding: ${spacing.padding} !important;
                }
                .org-level-horizontal {
                    gap: ${spacing.gap} !important;
                }
            `;
            
            document.head.appendChild(style);
        }

        function changeBorderRadius() {
            if (!checkAdminAccess('change border radius')) {
                document.getElementById('borderRadius').value = customizationSettings.borderRadius;
                return;
            }
            
            customizationSettings.borderRadius = document.getElementById('borderRadius').value;
            applyBorderRadius();
        }

        function applyBorderRadius() {
            const radii = {
                none: '0px',
                small: '4px',
                normal: '8px',
                large: '16px',
                full: '9999px'
            };
            
            const radius = radii[customizationSettings.borderRadius];
            
            const style = document.createElement('style');
            style.id = 'borderradius-override';
            
            const existing = document.getElementById('borderradius-override');
            if (existing) existing.remove();
            
            style.textContent = `
                .org-box {
                    border-radius: ${radius} !important;
                }
                .search-container {
                    border-radius: ${radius} !important;
                }
            `;
            
            document.head.appendChild(style);
        }

        function changeBoxShadow() {
            if (!checkAdminAccess('change box shadow')) {
                document.getElementById('boxShadow').value = customizationSettings.boxShadow;
                return;
            }
            
            customizationSettings.boxShadow = document.getElementById('boxShadow').value;
            applyBoxShadow();
        }

        function applyBoxShadow() {
            const shadows = {
                none: 'none',
                small: '0 1px 3px rgba(0, 0, 0, 0.1)',
                normal: '0 4px 6px rgba(0, 0, 0, 0.1)',
                large: '0 10px 15px rgba(0, 0, 0, 0.1)',
                'extra-large': '0 25px 50px rgba(0, 0, 0, 0.25)'
            };
            
            const shadow = shadows[customizationSettings.boxShadow];
            
            const style = document.createElement('style');
            style.id = 'boxshadow-override';
            
            const existing = document.getElementById('boxshadow-override');
            if (existing) existing.remove();
            
            style.textContent = `
                .org-box {
                    box-shadow: ${shadow} !important;
                }
                .org-box:hover {
                    box-shadow: ${shadow === 'none' ? 'none' : '0 8px 25px rgba(59, 130, 246, 0.15)'} !important;
                }
            `;
            
            document.head.appendChild(style);
        }

        function toggleDragDrop() {
            if (!checkAdminAccess('toggle drag and drop')) {
                document.getElementById('dragDropEnabled').checked = customizationSettings.dragDropEnabled;
                return;
            }
            
            customizationSettings.dragDropEnabled = document.getElementById('dragDropEnabled').checked;
            applyDragDrop();
        }

        function applyDragDrop() {
            const orgBoxes = document.querySelectorAll('.org-box');
            
            orgBoxes.forEach(box => {
                if (customizationSettings.dragDropEnabled) {
                    box.style.cursor = 'move';
                    box.draggable = true;
                    box.addEventListener('dragstart', handleDragStart);
                    box.addEventListener('dragover', handleDragOver);
                    box.addEventListener('drop', handleDrop);
                } else {
                    box.style.cursor = 'pointer';
                    box.draggable = false;
                    box.removeEventListener('dragstart', handleDragStart);
                    box.removeEventListener('dragover', handleDragOver);
                    box.removeEventListener('drop', handleDrop);
                }
            });
        }

        function handleDragStart(e) {
            dragElement = e.target;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            if (dragElement !== e.target) {
                // Simple position swap
                const dragParent = dragElement.parentNode;
                const dropParent = e.target.parentNode;
                
                const dragNext = dragElement.nextSibling;
                const dropNext = e.target.nextSibling;
                
                dragParent.insertBefore(e.target, dragNext);
                dropParent.insertBefore(dragElement, dropNext);
            }
        }

        function toggleEditMode() {
            if (!checkAdminAccess('toggle edit mode')) return;
            
            editMode = !editMode;
            const btn = document.getElementById('editModeBtn');
            
            if (editMode) {
                btn.textContent = 'üíæ Save Changes';
                btn.className = 'w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors';
                enableEditMode();
            } else {
                btn.textContent = '‚úèÔ∏è Enter Edit Mode';
                btn.className = 'w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors';
                disableEditMode();
            }
        }

        function enableEditMode() {
            const orgBoxes = document.querySelectorAll('.org-box');
            orgBoxes.forEach(box => {
                box.style.border = '2px dashed #3b82f6';
                box.contentEditable = true;
                box.addEventListener('blur', saveBoxContent);
            });
        }

        function disableEditMode() {
            const orgBoxes = document.querySelectorAll('.org-box');
            orgBoxes.forEach(box => {
                box.style.border = '';
                box.contentEditable = false;
                box.removeEventListener('blur', saveBoxContent);
            });
        }

        function saveBoxContent(e) {
            // In a real application, you would save this to your data structure
            console.log('Box content updated:', e.target.textContent);
        }

        function applyCustomCSS() {
            if (!checkAdminAccess('apply custom CSS')) {
                document.getElementById('customCSS').value = customizationSettings.customCSS;
                return;
            }
            
            customizationSettings.customCSS = document.getElementById('customCSS').value;
            
            const style = document.createElement('style');
            style.id = 'custom-css-override';
            
            const existing = document.getElementById('custom-css-override');
            if (existing) existing.remove();
            
            try {
                style.textContent = customizationSettings.customCSS;
                document.head.appendChild(style);
            } catch (error) {
                alert('‚ùå Invalid CSS syntax. Please check your custom CSS.');
            }
        }

        function exportSettings() {
            const settings = {
                ...customizationSettings,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'org-chart-settings.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importSettings(event) {
            if (!checkAdminAccess('import settings')) {
                event.target.value = '';
                return;
            }
            
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const settings = JSON.parse(e.target.result);
                    customizationSettings = { ...customizationSettings, ...settings };
                    loadCustomizationSettings();
                    alert('‚úÖ Settings imported successfully!');
                } catch (error) {
                    alert('‚ùå Invalid settings file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function generateHTML() {
            if (!checkAdminAccess('generate HTML')) return;
            
            // Get current HTML with all customizations applied
            const currentHTML = document.documentElement.outerHTML;
            
            // Create a clean version with embedded styles
            const cleanHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Organizational Chart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Custom Styles Applied -->
    <style>
        ${Array.from(document.querySelectorAll('style')).map(style => style.textContent).join('\n')}
    </style>
</head>
<body class="${document.body.className}">
    ${document.getElementById('mainApp').outerHTML}
    
    <script>
        // Embedded customization settings
        const customizationSettings = ${JSON.stringify(customizationSettings, null, 2)};
        
        // Add your organizational data and functions here
        // This is a simplified version - you would include all necessary JavaScript
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96bcd179e3adfedf',t:'MTc1NDYzMzA4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>`;
            
            const blob = new Blob([cleanHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'custom-org-chart.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('üîß Custom HTML file generated and downloaded!\n\nThis file contains your current customizations and can be used as a standalone organizational chart.');
        }

        function applyTheme(themeName) {
            customizationSettings.theme = themeName;
            
            const themes = {
                default: {
                    board: 'linear-gradient(135deg, #1e3a8a, #1e40af)',
                    executive: 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
                    pldtOps: 'linear-gradient(135deg, #dc2626, #b91c1c)',
                    smartOps: 'linear-gradient(135deg, #16a34a, #15803d)',
                    sharedServices: 'linear-gradient(135deg, #6b7280, #4b5563)',
                    subFunction: 'linear-gradient(135deg, #3b82f6, #2563eb)',
                    avp: 'linear-gradient(135deg, #f59e0b, #d97706)',
                    seniorManager: 'linear-gradient(135deg, #64748b, #475569)',
                    officer: 'linear-gradient(135deg, #a16207, #92400e)'
                },
                corporate: {
                    board: 'linear-gradient(135deg, #374151, #1f2937)',
                    executive: 'linear-gradient(135deg, #4b5563, #374151)',
                    pldtOps: 'linear-gradient(135deg, #6b7280, #4b5563)',
                    smartOps: 'linear-gradient(135deg, #6b7280, #4b5563)',
                    sharedServices: 'linear-gradient(135deg, #9ca3af, #6b7280)',
                    subFunction: 'linear-gradient(135deg, #9ca3af, #6b7280)',
                    avp: 'linear-gradient(135deg, #6b7280, #4b5563)',
                    seniorManager: 'linear-gradient(135deg, #9ca3af, #6b7280)',
                    officer: 'linear-gradient(135deg, #d1d5db, #9ca3af)'
                },
                modern: {
                    board: 'linear-gradient(135deg, #065f46, #047857)',
                    executive: 'linear-gradient(135deg, #0d9488, #0f766e)',
                    pldtOps: 'linear-gradient(135deg, #0891b2, #0e7490)',
                    smartOps: 'linear-gradient(135deg, #0891b2, #0e7490)',
                    sharedServices: 'linear-gradient(135deg, #0d9488, #0f766e)',
                    subFunction: 'linear-gradient(135deg, #06b6d4, #0891b2)',
                    avp: 'linear-gradient(135deg, #0d9488, #0f766e)',
                    seniorManager: 'linear-gradient(135deg, #06b6d4, #0891b2)',
                    officer: 'linear-gradient(135deg, #22d3ee, #06b6d4)'
                },
                warm: {
                    board: 'linear-gradient(135deg, #c2410c, #ea580c)',
                    executive: 'linear-gradient(135deg, #d97706, #f59e0b)',
                    pldtOps: 'linear-gradient(135deg, #dc2626, #f59e0b)',
                    smartOps: 'linear-gradient(135deg, #dc2626, #f59e0b)',
                    sharedServices: 'linear-gradient(135deg, #d97706, #f59e0b)',
                    subFunction: 'linear-gradient(135deg, #f59e0b, #fbbf24)',
                    avp: 'linear-gradient(135deg, #f59e0b, #fbbf24)',
                    seniorManager: 'linear-gradient(135deg, #fbbf24, #facc15)',
                    officer: 'linear-gradient(135deg, #facc15, #fde047)'
                }
            };
            
            const theme = themes[themeName];
            const style = document.createElement('style');
            style.id = 'theme-override';
            
            // Remove existing theme
            const existing = document.getElementById('theme-override');
            if (existing) existing.remove();
            
            style.textContent = `
                .org-box.board { background: ${theme.board} !important; }
                .org-box.executive { background: ${theme.executive} !important; }
                .org-box.pldt-ops { background: ${theme.pldtOps} !important; }
                .org-box.smart-ops { background: ${theme.smartOps} !important; }
                .org-box.shared-services { background: ${theme.sharedServices} !important; }
                .org-box.sub-function { background: ${theme.subFunction} !important; }
                .org-box.avp { background: ${theme.avp} !important; }
                .org-box.senior-manager { background: ${theme.seniorManager} !important; }
                .org-box.officer { background: ${theme.officer} !important; }
            `;
            
            document.head.appendChild(style);
        }

        function toggleCompactMode() {
            customizationSettings.compactMode = document.getElementById('compactMode').checked;
            applyCompactMode();
        }

        function applyCompactMode() {
            const style = document.createElement('style');
            style.id = 'compact-override';
            
            // Remove existing
            const existing = document.getElementById('compact-override');
            if (existing) existing.remove();
            
            if (customizationSettings.compactMode) {
                style.textContent = `
                    .org-box {
                        min-width: 140px !important;
                        max-width: 180px !important;
                        padding: 8px !important;
                        margin: 4px !important;
                        font-size: 0.8rem !important;
                    }
                    .org-box .font-bold {
                        font-size: 0.75rem !important;
                    }
                    .horizontal-container {
                        gap: 20px !important;
                    }
                `;
            }
            
            document.head.appendChild(style);
        }

        function toggleJobCounts() {
            customizationSettings.showJobCounts = document.getElementById('showJobCounts').checked;
            applyJobCountsVisibility();
        }

        function applyJobCountsVisibility() {
            const style = document.createElement('style');
            style.id = 'jobcounts-override';
            
            // Remove existing
            const existing = document.getElementById('jobcounts-override');
            if (existing) existing.remove();
            
            if (!customizationSettings.showJobCounts) {
                style.textContent = `
                    .job-count {
                        display: none !important;
                    }
                `;
            }
            
            document.head.appendChild(style);
        }

        function toggleLevels() {
            customizationSettings.showLevels = document.getElementById('showLevels').checked;
            applyLevelsVisibility();
        }

        function applyLevelsVisibility() {
            const style = document.createElement('style');
            style.id = 'levels-override';
            
            // Remove existing
            const existing = document.getElementById('levels-override');
            if (existing) existing.remove();
            
            if (!customizationSettings.showLevels) {
                style.textContent = `
                    .org-box .text-xs.mt-2.opacity-80 {
                        display: none !important;
                    }
                `;
            }
            
            document.head.appendChild(style);
        }

        function changeFontSize() {
            customizationSettings.fontSize = document.getElementById('fontSize').value;
            applyFontSize();
        }

        function applyFontSize() {
            const sizes = {
                small: '0.75rem',
                medium: '0.875rem',
                large: '1rem',
                'extra-large': '1.125rem'
            };
            
            const style = document.createElement('style');
            style.id = 'fontsize-override';
            
            // Remove existing
            const existing = document.getElementById('fontsize-override');
            if (existing) existing.remove();
            
            style.textContent = `
                .org-box {
                    font-size: ${sizes[customizationSettings.fontSize]} !important;
                }
                .org-box .font-bold {
                    font-size: calc(${sizes[customizationSettings.fontSize]} + 0.125rem) !important;
                }
            `;
            
            document.head.appendChild(style);
        }

        function changeFontStyle() {
            customizationSettings.fontStyle = document.getElementById('fontStyle').value;
            applyFontStyle();
        }

        function applyFontStyle() {
            const fonts = {
                system: 'system-ui, -apple-system, sans-serif',
                modern: 'Inter, system-ui, sans-serif',
                classic: 'Times, "Times New Roman", serif',
                tech: 'Monaco, "Cascadia Code", monospace'
            };
            
            const style = document.createElement('style');
            style.id = 'fontstyle-override';
            
            // Remove existing
            const existing = document.getElementById('fontstyle-override');
            if (existing) existing.remove();
            
            style.textContent = `
                .org-box {
                    font-family: ${fonts[customizationSettings.fontStyle]} !important;
                }
            `;
            
            document.head.appendChild(style);
        }

        function toggleAnimations() {
            customizationSettings.enableAnimations = document.getElementById('enableAnimations').checked;
            applyAnimations();
        }

        function applyAnimations() {
            const style = document.createElement('style');
            style.id = 'animations-override';
            
            // Remove existing
            const existing = document.getElementById('animations-override');
            if (existing) existing.remove();
            
            if (!customizationSettings.enableAnimations) {
                style.textContent = `
                    .org-box {
                        transition: none !important;
                    }
                    .org-box:hover {
                        transform: none !important;
                    }
                `;
            }
            
            document.head.appendChild(style);
        }

        function toggleShadows() {
            customizationSettings.enableShadows = document.getElementById('enableShadows').checked;
            applyShadows();
        }

        function applyShadows() {
            const style = document.createElement('style');
            style.id = 'shadows-override';
            
            // Remove existing
            const existing = document.getElementById('shadows-override');
            if (existing) existing.remove();
            
            if (!customizationSettings.enableShadows) {
                style.textContent = `
                    .org-box:hover {
                        box-shadow: none !important;
                    }
                    .search-container {
                        box-shadow: none !important;
                    }
                `;
            }
            
            document.head.appendChild(style);
        }

        function applyAllCustomizations() {
            applyTheme(customizationSettings.theme);
            applyCompactMode();
            applyJobCountsVisibility();
            applyLevelsVisibility();
            applyFontSize();
            applyFontStyle();
            applyAnimations();
            applyShadows();
            applyHeaderLogo();
            applyHeaderTitle();
            applyHeaderSubtitle();
            applyBackground();
            applyHeaderBackground();
            applyConnectionLines();
            applyLayoutSpacing();
            applyBorderRadius();
            applyBoxShadow();
            applyDragDrop();
            applyCustomCSS();
        }

        function saveCustomization() {
            localStorage.setItem('orgChartCustomization', JSON.stringify(customizationSettings));
            
            // Show success message
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Saved!';
            button.style.background = '#10b981';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 2000);
        }

        function resetToDefault() {
            // Reset settings
            customizationSettings = {
                theme: 'default',
                compactMode: false,
                showJobCounts: true,
                showLevels: true,
                fontSize: 'medium',
                fontStyle: 'system',
                enableAnimations: true,
                enableShadows: true
            };
            
            // Remove all custom styles
            ['theme-override', 'compact-override', 'jobcounts-override', 'levels-override', 
             'fontsize-override', 'fontstyle-override', 'animations-override', 'shadows-override'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.remove();
            });
            
            // Update UI controls
            loadCustomizationSettings();
            
            // Clear localStorage
            localStorage.removeItem('orgChartCustomization');
            
            alert('üîÑ Interface reset to default settings!');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on password input
            document.getElementById('passwordInput').focus();
            
            // Close modals when clicking outside
            document.getElementById('jobModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeJobModal();
                }
            });
            
            document.getElementById('customizerModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCustomizer();
                }
            });
            
            // Close modals with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeJobModal();
                    closeCustomizer();
                }
            });
            
            // Load saved customizations
            loadCustomizationSettings();
        });
    </script>
</body>
</html>
